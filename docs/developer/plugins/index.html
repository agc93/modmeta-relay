<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.62.2"><meta name=ROBOTS content="INDEX, FOLLOW"><link rel="shortcut icon" href=../../../favicons/favicon.ico><link rel=apple-touch-icon href=../../../favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=../../../favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=../../../favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=../../../favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=../../../favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=../../../favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=../../../favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=../../../favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=../../../favicons/android-192x192.png sizes=192x192><title>Building Plugins | ModMeta Relay</title><meta property="og:title" content="Building Plugins"><meta property="og:description" content="An introduction to building Relay plugins."><meta property="og:type" content="article"><meta property="og:url" content="/docs/developer/plugins/"><meta property="article:modified_time" content="2020-09-13T02:12:14+10:00"><meta property="og:site_name" content="ModMeta Relay"><meta itemprop=name content="Building Plugins"><meta itemprop=description content="An introduction to building Relay plugins."><meta itemprop=dateModified content="2020-09-13T02:12:14+10:00"><meta itemprop=wordCount content="417"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Building Plugins"><meta name=twitter:description content="An introduction to building Relay plugins."><link rel=preload href=../../../scss/main.min.88e8f51c71d38785c1a4759cf90fd4d86a754c5cf2f92b01a51b8f9ff4ff9395.css as=style><link href=../../../scss/main.min.88e8f51c71d38785c1a4759cf90fd4d86a754c5cf2f92b01a51b8f9ff4ff9395.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.3.1.min.js integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin=anonymous></script><script src=https://unpkg.com/lunr@2.3.8/lunr.min.js integrity=sha384-vRQ9bDyE0Wnu+lMfm57BlYLO0/XauFuKpVsZPs7KEDwYKktWi5+Kz3MP8++DFlRY crossorigin=anonymous></script></head><body class=td-page><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=../../../><span class=navbar-logo></span><span class="text-uppercase font-weight-bold">ModMeta Relay</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=../../../docs/><span class=active>Documentation</span></a></li></ul></div><div class="navbar-nav d-none d-lg-block"><input type=search class="form-control td-search-input" placeholder="&#xf002; Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=../../../offline-search-index.9b001dfbe96f17a781aa1ffc7a5cca5c34ea2287bee78f4567063828828791ad80fc7b5ab7b4f5b0f0985c8919fc3c97de2880e266b90c05087015b112ea424e.json data-offline-search-base-href=../../../></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center"><input type=search class="form-control td-search-input" placeholder="&#xf002; Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=../../../offline-search-index.9b001dfbe96f17a781aa1ffc7a5cca5c34ea2287bee78f4567063828828791ad80fc7b5ab7b4f5b0f0985c8919fc3c97de2880e266b90c05087015b112ea424e.json data-offline-search-base-href=../../../>
<button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-docs-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="collapse td-sidebar-nav pt-2 pl-4" id=td-section-nav><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=../../../docs/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">Documentation</a></li><ul><li class="collapse show" id=docs><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=../../../docs/introduction/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Introduction</a></li><ul><li class=collapse id=docsintroduction><a class="td-sidebar-link td-sidebar-link__page" id=m-docsintroductionbasics href=../../../docs/introduction/basics/>ModMeta Basics</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsintroductionplugins href=../../../docs/introduction/plugins/>Plugins</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsintroductionfaq href=../../../docs/introduction/faq/>FAQ</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=../../../docs/usage/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Usage</a></li><ul><li class=collapse id=docsusage><a class="td-sidebar-link td-sidebar-link__page" id=m-docsusageinstallation href=../../../docs/usage/installation/>Run the Server</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsusageplugins href=../../../docs/usage/plugins/>Adding Plugins</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsusagevortex href=../../../docs/usage/vortex/>Configure Vortex</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=../../../docs/developer/ class="align-left pl-0 pr-2 active td-sidebar-link td-sidebar-link__section">Development</a></li><ul><li class="collapse show" id=docsdeveloper><a class="td-sidebar-link td-sidebar-link__page" id=m-docsdevelopermodmeta href=../../../docs/developer/modmeta/>ModMeta API</a>
<a class="td-sidebar-link td-sidebar-link__page active" id=m-docsdeveloperplugins href=../../../docs/developer/plugins/>Plugins</a></li></ul></ul></li></ul></ul></nav></div></div><div class="d-none d-xl-block col-xl-2 td-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"><a href=https://github.com/agc93/modmeta-relay/edit/master/docs//content/en/docs/developer/plugins.md target=_blank><i class="fa fa-edit fa-fw"></i>Edit this page</a>
<a href="https://github.com/agc93/modmeta-relay/issues/new?title=Building%20Plugins" target=_blank><i class="fab fa-github fa-fw"></i>Create documentation issue</a></div><nav id=TableOfContents><ul><li><a href=#introduction>Introduction</a></li><li><a href=#implementing-a-metadata-source>Implementing a metadata source</a><ul><li><a href=#request-type-support>Request Type Support</a></li><li><a href=#async-and-timeouts>Async and timeouts</a></li></ul></li><li><a href=#complex-plugins-and-imodmetaplugin>Complex Plugins and IModMetaPlugin</a></li></ul></nav></div><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><nav aria-label=breadcrumb class="d-none d-md-block d-print-none"><ol class="breadcrumb spb-1"><li class=breadcrumb-item><a href=../../../docs/>Documentation</a></li><li class=breadcrumb-item><a href=../../../docs/developer/>Development</a></li><li class="breadcrumb-item active" aria-current=page><a href=../../../docs/developer/plugins/>Plugins</a></li></ol></nav><div class=td-content><h1>Building Plugins</h1><div class=lead>An introduction to building Relay plugins.</div><h2 id=introduction>Introduction</h2><p>At their most basic, a Relay plugin is simply an assembly with an implementation of <code>IModMetaSource</code> (from <code>ModMeta.Core</code>), and optionally an implementation of <code>IModMetaPlugin</code>.</p><p>The <code>IModMetaSource</code> interface is how the Relay server passes mod metadata queries to your plugin and handles the responses to pass on to the original client.</p><h2 id=implementing-a-metadata-source>Implementing a metadata source</h2><p>In short, add a reference to <a href=https://www.nuget.org/packages/ModMeta/><code>ModMeta.Core</code></a> and implement the <code>IModMetaSource</code> interface. The various <code>GetBy*</code> methods are the main entry points the server will call when it gets a request for a mod.</p><h3 id=request-type-support>Request Type Support</h3><p>Since not every <a href=../../../docs/developer/modmeta/#request-types>request type</a> might make sense for the metadata source you're building, plugins can choose to only work with certain request types.</p><p>If your plugin doesn't support a request type <em>at all</em>, not returning it from the <code>SupportedTypes</code> property will cause the server to never even call your plugin for that type. If you only want to skip <em>certain</em> requests, throwing a <code>NotImplementedException</code> will cause the server to ignore your plugin's results for that request.</p><h3 id=async-and-timeouts>Async and timeouts</h3><p>All configured plugins are called by the server at the same time for each request. If you're familiar with the TPL, we're currently using <code>Task.WhenAll()</code> so your plugin will <em>not</em> be running in a different thread. To keep UX non-awful, there's a hard limit configured of 5 seconds after which any plugins that haven't returned their results are ignored. Given metaservers calls often block installation (as they do in Vortex), making your plugin return data as fast as possible will lead to a much better experience.</p><h2 id=complex-plugins-and-imodmetaplugin>Complex Plugins and <code>IModMetaPlugin</code></h2><p>If your mod has more advanced requirements or you want to take advantage of runtime DI, you can register your plugin using an implementation of <code>IModMetaPlugin</code>. Much like a metadata source (<code>IModMetaSource</code>), the server will dynamically load your plugin and locate your implementation of <code>IModMetaPlugin</code>.</p><blockquote><p>If you use <code>IModMetaPlugin</code>, the server will <em>not</em> automatically register your <code>IModMetaSource</code> implementation, you need to do that yourself in the <code>ConfigureServices</code> method.</p></blockquote><p>Using the <code>IModMetaPlugin.ConfigureServices</code> method, you can register any dependencies you need or read configuration from the host server. For example:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>IServiceCollection</span> <span style=color:#000>ConfigureServices</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>IServiceCollection</span> <span style=color:#000>services</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>IConfiguration</span> <span style=color:#000>configuration</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000;font-weight:700>{</span>
    <span style=color:#000>services</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>AddSingleton</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#000>BeatModsClient</span><span style=color:#000;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>(</span><span style=color:#000;font-weight:700>)</span><span style=color:#000;font-weight:700>;</span>
    <span style=color:#000>services</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>AddSingleton</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#000>IModMetaSource</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>BeatModsSource</span><span style=color:#000;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>(</span><span style=color:#000;font-weight:700>)</span><span style=color:#000;font-weight:700>;</span>
    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>services</span><span style=color:#000;font-weight:700>;</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></div><p>It's worth noting that (with some exceptions) you won't be able to access all the services from the host server's DI container. The exceptions to this are <code>IConfiguration</code> and <code>ILogger</code>. This means you can add the <code>Microsoft.Extensions.Logging</code> package to your plugin then just inject <code>ILogger&lt;></code> into any of your plugin types to write out logs.</p><div class="text-muted mt-5 pt-3 border-top">Last modified September 13, 2020: <a href=https://github.com/agc93/modmeta-relay/commit/ef92b47cd992cac062d7a89106775384c36b2ed4>Minor docs fixes (ef92b47)</a></div></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank href=https://github.com/agc93/modmeta-relay><i class="fab fa-github"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2020 agc93 All Rights Reserved</small></div></div></div></footer></div><script src=https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js integrity=sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49 crossorigin=anonymous></script><script src=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js integrity=sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy crossorigin=anonymous></script><script src=../../../js/main.min.7afee248b9b3c1d4438c6841cc272ae0ac1f81a3ee5c0ed939f1d57c18de3f7d.js integrity="sha256-ev7iSLmzwdRDjGhBzCcq4KwfgaPuXA7ZOfHVfBjeP30=" crossorigin=anonymous></script></body></html>